<?xml version="1.0" encoding="UTF-8" ?>


<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="curriculum">

    <!--성우-->
    <select id="getCateName" resultType="String">
        <![CDATA[
        SELECT CateName from CurriculumCate group by CateName
        ]]>
    </select>

    <select id="getCurri" parameterType="String" resultType="CurriculumVo">
        <![CDATA[
         select Curriculum_no, CurriName from Curriculum C
  			join CurriculumCate C2 on C.CurriculumCate_no = C2.CurriculumCate_no and C2.CateName=#{workType}
        ]]>
    </select>

    <select id="getCurriInfo" parameterType="Int" resultType="CurriculumVo">
        <![CDATA[
        select CurriName, StartDate, EndDate from Curriculum where Curriculum_no=#{curriculum_no};
        ]]>
    </select>
    <!--성우-->



    <!--희준-->
    <!-- 커리큘럼 조회 -->
     <select id="viewCurriculum" parameterType="String" resultType="com.bitacademy.vo.CurriculumVo" >
 		<![CDATA[
  			SELECT 	c.workType, c.curriculum_no, c.package_no, c.curriName, 
  					c.startDate, c.endDate, c.testDate, c.time, c.maxCnt, c.price, 
  					c.support, c.managerInfo, c.state, c.curriNickname, c.curriculumCate_no, p.packageName, g.gisuName 
			FROM Curriculum as c, Package as p, Gisu as g
			WHERE c.Package_no = p.Package_no 
			AND g.Curriculum_no = c.Curriculum_no
			AND c.curriculum_no = #{curriculum_no};
  		]]> 
  	</select>
 	
	<!-- 커리큘럼 수정 -->
    <update id = "edit" parameterType = "com.bitacademy.vo.CurriculumVo">
 		<![CDATA[
 			UPDATE Curriculum
 			SET
 			curriName = #{curriName}
 			, curriNickname = #{curriNickname}
 			, startDate = #{startDate}
 			, endDate = #{endDate}
 			, testDate = #{testDate}
 			, time = #{time}
 			, maxCnt = #{maxCnt}
 			, price = #{price}
 			, support = #{support}
 			, managerInfo = #{managerInfo}
 			, state = #{state}
 			WHERE curriculum_no = #{curriculum_no}
 		]]>
 	</update>

	<!-- 커리큘럼 추가 -->
    <insert id="addCurri" parameterType = "com.bitacademy.vo.CurriculumVo">
 		<![CDATA[
 			INSERT INTO Curriculum (curriculumCate_no, workType, curriName, curriNickname, periodFr, periodTo, startDay, time, num, money, support, inquiry, state, package_no)
			VALUES(
				(SELECT curriculumCate_no FROM CurriculumCate WHERE curriculumCate_no = #{curriculumCate_no}),
				#{workType},
				#{curriName},
				#{curriNickname},
				#{startDate},
				#{endDate},
				#{testDate},
				#{time},
				#{maxCnt},
				#{price},
				#{support},
				#{managerInfo},
				#{state},
			    (SELECT package_no from Package WHERE package_no = #{package_no})
			    );
 		]]>
 	</insert>
 	
 	<!-- 교육생관리탭 교육생조회 -->
    <select id = "studentManagement"  resultType = "com.bitacademy.vo.ApplicantVo">
		<![CDATA[
			SELECT  u.user_no, u.nameHan, u.birthDate, CASE u.gender WHEN 1 THEN '여자' ELSE '남자' END gender, a.testResult, c.curriname
			FROM Users as u, ApplyInfo as a, Curriculum as c
			WHERE u.User_no = a.User_no and c.curriculum_no = 1 and a.curriculum_no = 1
		]]>
	</select>
	
    <select id = "currilist"  resultType = "com.bitacademy.vo.CurriculumVo">
		<![CDATA[
			SELECT workType, curriculum_no, package_no, curriculumCate_no, workType, curriName, startDate, endDate, testDate, time, maxCnt, price, support, managerInfo, state, curriNickname
			FROM Curriculum;
		]]>
	</select>

    <select id = "curriCateList" resultType = "com.bitacademy.vo.CurriculumCateVo">
		<![CDATA[
			SELECT curriculumCate_no, cateName, groupCode, parentCode, depth
			FROM CurriculumCate;
		]]>
	</select>
	
<!-- 	//전체지원자리스트 조회 -->
	<select id = "viewApplicantList" parameterType="String" resultType = "com.bitacademy.vo.ApplicantVo">
		<![CDATA[
			SELECT u.User_no, u.NameHan, u.BirthDate, u.gender, a.TestResult, c.curriculum_no
			FROM ApplyInfo as a, Users as u, Curriculum as c 
			WHERE a.User_no = u.User_no
			AND c.curriculum_no = a.curriculum_no
			AND a.curriculum_no = #{curriculum_no}
		]]>
	
	</select>


    <!--
    <select id = "studentManagement" parameterType = "String" resultType = "com.bitacademy.vo.ApplicantVo">
        <![CDATA[

            select  u.User_no, u.NameHan, u.BirthDate, a.TestResult
            from Users as u, ApplyInfo as a
            where u.User_no = a.User_no

        ]]>

    </select>
     -->
<!--희준-->

</mapper>
