<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="completion">

<!-- <select id="getValStudent" resultType="com.bitacademy.vo.UsersVo">

<![CDATA[
		select * from Users 
				 where curriculum.workType=WorkType,
				 	   curriculum.curriName=CurriName,
				 	   curriculum.state=State;
	]]>

</select> -->

<select id="getCompletionStudent" parameterType="int" resultType="com.bitacademy.vo.ApplyUserVo">

<![CDATA[
	   select Users.User_no, Gisu.GisuName,Users.NameHan, Users.BirthDate,Users.Gender,
	   		  ApplyInfo.TestResult,Users.Cellphone,ApplyInfo.ApplyDate, ApplyInfo.TestDate,
	   		  UserScholarship.School, UserScholarship.Major,
	   		  ApplyInfo.Deposit
	   from ApplyInfo
	   join Users on Users.User_no = ApplyInfo.User_no
	   join UserScholarship on Users.User_no = UserScholarship.User_no
	   join Curriculum on ApplyInfo.Curriculum_no = Curriculum.Curriculum_no
	   join Gisu on Curriculum.Curriculum_no = Gisu.Curriculum_no
	   where Curriculum.Curriculum_no = #{curriculum_no};

	]]>
</select>
<!-- 조회버튼 클릭 후 그리드영역 학생리스트 가져가기 -->

<select id="afterServiceList" parameterType="int" resultType="com.bitacademy.vo.UserCareerVo">

<![CDATA[
		
	   select UserCareer.CompName,UserCareer.StartDate,UserCareer.EndDate,UserCareer.State,
	   		  UserCareer.UserCareer_no,Users.User_no
	   		  
	   from UserCareer
	
	   join Users on Users.User_no = UserCareer.User_no
	   
	   where Users.User_no = #{user_no};
	]]>

</select><!-- 선택된 학생의 취업정보 가져가기 -->

<select id="afterService_details" parameterType="map" resultType="com.bitacademy.vo.UserCareerVo">

<![CDATA[
            
	  select UserCareer.CompName,UserCareer.TelePhone,UserCareer.StartDate,UserCareer.UserCareer_no,
			 UserCareer.EndDate,UserCareer.Role,UserCareer.Department,
			 UserCareer.State,UserCareer.CompanyAddress,Users.User_no
	
	  from UserCareer as UserCareer

	  join Users as Users on UserCareer.User_no = Users.User_no
      join Interview as Interview on Users.User_no = Interview.User_no
      join Company as Company on Interview.Commpany_no = Company.Commpany_no 

	  where UserCareer.UserCareer_no=#{userCareer_no} and UserCareer.User_no = #{user_no};
	
	]]>

</select><!-- 클릭된 취업내용 상세내역 가져가기 -->

<update id="afterServiceUpdate" parameterType="com.bitacademy.vo.UserCareerVo">
	 <choose>
	 <when test="startDate.equals('')">
		<![CDATA[

				update UserCareer
								set CompName=#{compName},
									EndDate=#{endDate},
									Role=#{role},
									TelePhone=#{telePhone},
									State=#{state},
									Department=#{department}
						where User_no=#{user_no};

		]]>
	</when>
	<when test="endDate.equals('')">
		<![CDATA[

				update UserCareer
								set CompName=#{compName},
									StartDate=#{startDate},
									Role=#{role},
									TelePhone=#{telePhone},
									State=#{state},
									Department=#{department}
						where User_no=#{user_no};

		]]>
	</when>
	<otherwise>
		<![CDATA[

				update UserCareer
								set CompName=#{compName},
									StartDate=#{startDate},
									EndDate=#{endDate},
									Role=#{role},
									TelePhone=#{telePhone},
									State=#{state},
									Department=#{department}
						where User_no=#{user_no};

		]]>
	</otherwise>
	</choose>
</update><!-- 수정버튼 클릭 후 취업상세내용 업데이트하기 -->

<insert id="afterServiceAdd" parameterType="com.bitacademy.vo.UserCareerVo">
	<choose>
	<when test="startDate.equals('')">
		<![CDATA[
		insert into UserCareer(User_no,EndDate,CompName,Role,TelePhone,CompanyAddress,State,Department)
		values(	#{user_no},
				#{endDate},
				#{compName},
				#{role},
				#{telePhone},
				#{companyAddress},
				#{state},
				#{department}
				)
		]]>
	</when>
	<when test="endDate.equals('')">
		<![CDATA[
		insert into UserCareer(User_no,StartDate,CompName,Role,TelePhone,CompanyAddress,State,Department)
		values(	#{user_no},
				#{startDate},
				#{compName},
				#{role},
				#{telePhone},
				#{companyAddress},
				#{state},
				#{department}
				)
		]]>
	</when>
	<otherwise>
		<![CDATA[
		insert into UserCareer(User_no,StartDate,EndDate,CompName,Role,TelePhone,CompanyAddress,State,Department)
		values(	#{user_no},
				#{startDate},
				#{endDate},
				#{compName},
				#{role},
				#{telePhone},
				#{companyAddress},
				#{state},
				#{department}
				)
	]]>

	</otherwise>
	</choose>
</insert><!-- 저장 버튼 클릭 후 취업내용 추가하기 -->

</mapper>