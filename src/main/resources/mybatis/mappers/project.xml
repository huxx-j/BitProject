<?xml version="1.0" encoding="UTF-8" ?>


<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="project">

    <select id="getMemberName" parameterType="Int" resultType="UsersVo">
        <![CDATA[
        select u.User_no, u.NameHan,
        substring(u.StudResNum,1,6) StudResNum,
        (case u.Gender when 1 then '남' when 2 then '여' end) Gender
        from Users u, ApplyInfo a
        where a.User_no=u.User_no
        and a.Curriculum_no=#{curriNo}
        and a.State='비트생'
        ]]>
    </select>

    <select id="getTeamList" parameterType="Int" resultType="ProjectVo">
        <![CDATA[
        select Project_no, ProjectName, Curriculum_no
        from Project
        where Curriculum_no=#{curriculum_no}
        ]]>
    </select>

    <select id="getTeamMemberList" parameterType="Int" resultType="String">
        <![CDATA[
        select u.NameHan
        from ProjectMember pm, Users u
        where pm.User_no=u.User_no and Project_no=#{project_no}
        ]]>
    </select>

    <select id="getProjectDetail" parameterType="Int" resultType="ProjectVo">
        <![CDATA[
        select Project_no, Curriculum_no, ProjectName, Outline, Focus ,
        ApplyField, UseTechnique, File_no
        from Project
        where Project_no=#{project_no}
        ]]>
    </select>

    <select id="getTeamMembersNo" parameterType="Int" resultType="String">
        select u.User_no
        from ProjectMember pm, Users u
        where pm.User_no=u.User_no and Project_no=#{project_no}
    </select>

    <update id="updateProjectDetail" parameterType="ProjectVo">
            <![CDATA[
        update Project
        set ProjectName=#{projectName}, Outline=#{outline}, Focus=#{focus},
        ApplyField=#{applyField}, UseTechnique=#{useTechnique}, File_no=#{file_no}
        where Project_no=#{project_no} and Curriculum_no=#{curriculum_no}
        ]]>
    </update>


    <insert id="saveProjectDetail" parameterType="ProjectVo">
        <selectKey keyProperty="project_no" resultType="Int" order="AFTER">
            select LAST_INSERT_ID() from dual
        </selectKey>
        <![CDATA[
            insert into Project(Project_no, Curriculum_no, ProjectName, Outline, Focus, ApplyField, UseTechnique, File_no)
            values(#{project_no},#{curriculum_no}, #{projectName}, #{outline}, #{focus}, #{applyField}, #{useTechnique}, #{file_no})
          ]]>
    </insert>

    <insert id="saveProjectMember" parameterType="ProjectMemberVo">
        <![CDATA[
        insert into ProjectMember values (#{project_no}, #{user_no})
        ]]>
    </insert>

    <delete id="deleteProjectMember" parameterType="Int">
        <![CDATA[
        delete from ProjectMember where Project_no=#{project_no}
        ]]>
    </delete>

    <insert id="saveProjectFile" parameterType="FileVo">
        <selectKey keyProperty="file_no" resultType="Int" order="AFTER">
            <![CDATA[
            select LAST_INSERT_ID() from dual
            ]]>
        </selectKey>
        <![CDATA[
        insert into File(File_no, FileSize, FilePath, FileName)
        values (#{file_no},#{fileSize},#{filePath},#{fileName})
        ]]>
    </insert>
</mapper>
